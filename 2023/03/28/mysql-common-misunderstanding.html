<h1 id="some-common-misunderstandings-of-mysql">Some Common Misunderstandings of MySQL</h1>

<h2 id="misunderstanding-1-conversion-between-utc-and-non-utc-timezones-are-one-to-one">Misunderstanding 1: Conversion between UTC and non-UTC timezones are one-to-one</h2>
<p>In MySQL, temporal values are stored in <code class="language-plaintext highlighter-rouge">timestamp</code> as UTC values. When inserting and retrieving <code class="language-plaintext highlighter-rouge">timestamp</code> columns, if session time zone is not in UTC, there will be convertsion between UTC and session time zone.
Due to local time zone changes like Daylight Saving Time, conversions between UTC and non-UTC time zones are not one-to-one in both directions.
For example, two distinct UTC timestamps are not unique in MET timezone.</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tztable</span> <span class="p">(</span><span class="n">ts</span> <span class="nb">TIMESTAMP</span><span class="p">);</span>
<span class="c1">-- insert UTC values</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="n">time_zone</span> <span class="o">=</span> <span class="s1">'UTC'</span><span class="p">;</span> 
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tztable</span> <span class="k">VALUES</span>
       <span class="p">(</span><span class="s1">'2018-10-28 00:30:00'</span><span class="p">),</span>
       <span class="p">(</span><span class="s1">'2018-10-28 01:30:00'</span><span class="p">);</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">ts</span> <span class="k">FROM</span> <span class="n">tztable</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="n">ts</span>                  <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span> <span class="mi">01</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="n">time_zone</span> <span class="o">=</span> <span class="s1">'MET'</span><span class="p">;</span> <span class="c1">-- retrieve non-UTC values</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">ts</span> <span class="k">FROM</span> <span class="n">tztable</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="n">ts</span>                  <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span> <span class="mi">02</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span> <span class="mi">02</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>

</code></pre></div></div>

<p>Comparison of UTC and non-UTC timezones may yield different results, depending on if it is an indexed or nonindexed lookup.
If there’s no usable index on the <code class="language-plaintext highlighter-rouge">timestamp</code> column, comparison occurs in the session timezone. Specifically, the optimizer</p>
<ol>
  <li>first performs a table scan,</li>
  <li>retrieves all <code class="language-plaintext highlighter-rouge">ts</code> values,</li>
  <li>converts timestamp values from UTC to session time zone,</li>
  <li>compares them with the searched value.
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">ts</span> <span class="k">FROM</span> <span class="n">tztable</span> <span class="k">where</span> <span class="n">ts</span> <span class="o">=</span> <span class="s1">'2018-10-28 02:30:00'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="n">ts</span>                  <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span> <span class="mi">02</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span> <span class="mi">02</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>If there’s a usable index on the <code class="language-plaintext highlighter-rouge">timestamp</code> column, comparison occur in UTC. The optimizer does the following:</p>
<ol>
  <li>first performs an index scan,</li>
  <li>converts the search value from the session time zone to UTC,</li>
  <li>compares the result to the UTC index entries
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tstable</span> <span class="k">ADD</span> <span class="k">INDEX</span> <span class="p">(</span><span class="n">ts</span><span class="p">);</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="n">ts</span> <span class="k">FROM</span> <span class="n">tstable</span>
    <span class="k">WHERE</span> <span class="n">ts</span> <span class="o">=</span> <span class="s1">'2018-10-28 02:30:00'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="n">ts</span>                  <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span> <span class="mi">02</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
</code></pre></div>    </div>
  </li>
</ol>

<p><em>Reference</em>
https://dev.mysql.com/doc/refman/8.0/en/timestamp-lookups.html</p>

<h2 id="misunderstanding-2-comparing-dissimilar-columns-is-at-no-cost">Misunderstanding 2: Comparing dissimilar columns is at no cost</h2>
<p>Let’s start with a sample table.</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">teacher</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------+-------+-----+-------------+------------+</span>
<span class="o">|</span> <span class="n">id</span>     <span class="o">|</span> <span class="n">name</span>  <span class="o">|</span> <span class="n">age</span> <span class="o">|</span> <span class="n">contract_id</span> <span class="o">|</span> <span class="n">join_on</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+-------+-----+-------------+------------+</span>
<span class="o">|</span> <span class="mi">100000</span> <span class="o">|</span> <span class="n">john</span>  <span class="o">|</span>  <span class="mi">30</span> <span class="o">|</span> <span class="mi">100000</span>      <span class="o">|</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">100001</span> <span class="o">|</span> <span class="n">hanna</span> <span class="o">|</span>  <span class="mi">35</span> <span class="o">|</span> <span class="mi">100200</span>      <span class="o">|</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">100003</span> <span class="o">|</span> <span class="n">mary</span>  <span class="o">|</span>  <span class="mi">70</span> <span class="o">|</span> <span class="mi">100300</span>      <span class="o">|</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">100004</span> <span class="o">|</span> <span class="n">peter</span> <span class="o">|</span>  <span class="mi">66</span> <span class="o">|</span> <span class="mi">100400</span>      <span class="o">|</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------+-------+-----+-------------+------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">DESCRIBE</span> <span class="n">test</span><span class="p">.</span><span class="n">teacher</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------------+-------------+------+-----+---------+-------+</span>
<span class="o">|</span> <span class="n">Field</span>       <span class="o">|</span> <span class="k">Type</span>        <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------------+------+-----+---------+-------+</span>
<span class="o">|</span> <span class="n">id</span>          <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>        <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>         <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>     <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">contract_id</span> <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">MUL</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">join_on</span>     <span class="o">|</span> <span class="nb">date</span>        <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>       <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------------+------+-----+---------+-------+</span>
<span class="mi">5</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>
<p>Note the type of <code class="language-plaintext highlighter-rouge">contract_id</code> is <code class="language-plaintext highlighter-rouge">varchar</code> as you can see in <code class="language-plaintext highlighter-rouge">DESCRIBE</code>.
It’s not uncommon to see query like <code class="language-plaintext highlighter-rouge">SELECT * FROM test.teacher WHERE contract_id = 100400;</code>, where it compares a string column to a numeric literal. This, however, prevent use of indexes if values cannot be compared directly without conversion. Think about it, For a given value such as 1 in the numeric column, it might compare equal to any number of values in the string column such as ‘1’, ‘ 1’, ‘00001’, or ‘01.e1’. This means the potentially all values need to be compared.</p>

<p>We can understand better with <code class="language-plaintext highlighter-rouge">EXPLAIN</code> statement. Even though there are possible index <code class="language-plaintext highlighter-rouge">contract_id</code>, it is not used. The value for <code class="language-plaintext highlighter-rouge">row</code> column is 4 so we know that the optimizer does a full table scan and compares the value one by one.</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">EXPLAIN</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">test</span><span class="p">.</span><span class="n">teacher</span> <span class="k">where</span> <span class="n">contract_id</span> <span class="o">=</span> <span class="mi">100400</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">select_type</span> <span class="o">|</span> <span class="k">table</span>   <span class="o">|</span> <span class="n">partitions</span> <span class="o">|</span> <span class="k">type</span> <span class="o">|</span> <span class="n">possible_keys</span> <span class="o">|</span> <span class="k">key</span>  <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="k">rows</span> <span class="o">|</span> <span class="n">filtered</span> <span class="o">|</span> <span class="n">Extra</span>       <span class="o">|</span>
<span class="o">+</span><span class="c1">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">SIMPLE</span>      <span class="o">|</span> <span class="n">teacher</span> <span class="o">|</span> <span class="k">NULL</span>       <span class="o">|</span> <span class="k">ALL</span>  <span class="o">|</span> <span class="n">contract_id</span>   <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span>    <span class="mi">4</span> <span class="o">|</span>   <span class="mi">100</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">where</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span><span class="p">,</span> <span class="mi">3</span> <span class="n">warnings</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">SHOW WARNINGS</code> statement right after <code class="language-plaintext highlighter-rouge">EXPLAIN</code> provides detailed information regarding this collation conversion.</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">WARNINGS</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="k">Level</span>   <span class="o">|</span> <span class="n">Code</span> <span class="o">|</span> <span class="n">Message</span>                                                                                                                                                                                                                                                                             <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Warning</span> <span class="o">|</span> <span class="mi">1739</span> <span class="o">|</span> <span class="n">Cannot</span> <span class="n">use</span> <span class="k">ref</span> <span class="k">access</span> <span class="k">on</span> <span class="k">index</span> <span class="s1">'contract_id'</span> <span class="n">due</span> <span class="k">to</span> <span class="k">type</span> <span class="k">or</span> <span class="k">collation</span> <span class="k">conversion</span> <span class="k">on</span> <span class="n">field</span> <span class="s1">'contract_id'</span>                                                                                                                                                                             <span class="o">|</span>
<span class="o">|</span> <span class="n">Warning</span> <span class="o">|</span> <span class="mi">1739</span> <span class="o">|</span> <span class="n">Cannot</span> <span class="n">use</span> <span class="k">range</span> <span class="k">access</span> <span class="k">on</span> <span class="k">index</span> <span class="s1">'contract_id'</span> <span class="n">due</span> <span class="k">to</span> <span class="k">type</span> <span class="k">or</span> <span class="k">collation</span> <span class="k">conversion</span> <span class="k">on</span> <span class="n">field</span> <span class="s1">'contract_id'</span>                                                                                                                                                                           <span class="o">|</span>
<span class="o">|</span> <span class="n">Note</span>    <span class="o">|</span> <span class="mi">1003</span> <span class="o">|</span> <span class="cm">/* select#1 */</span> <span class="k">select</span> <span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`id`</span> <span class="k">AS</span> <span class="nv">`id`</span><span class="p">,</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`name`</span> <span class="k">AS</span> <span class="nv">`name`</span><span class="p">,</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`age`</span> <span class="k">AS</span> <span class="nv">`age`</span><span class="p">,</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`contract_id`</span> <span class="k">AS</span> <span class="nv">`contract_id`</span><span class="p">,</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`join_on`</span> <span class="k">AS</span> <span class="nv">`join_on`</span> <span class="k">from</span> <span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span> <span class="k">where</span> <span class="p">(</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`contract_id`</span> <span class="o">=</span> <span class="mi">100400</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<p>If we compare column <code class="language-plaintext highlighter-rouge">contract_id</code> with a string (the same data type), the optimizer would be able to use the index and gives the result very efficiently: see column <code class="language-plaintext highlighter-rouge">rows</code> which indicates that the optimizer is able to locate the exact one row that meets the requirement.</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">EXPLAIN</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">test</span><span class="p">.</span><span class="n">teacher</span> <span class="k">where</span> <span class="n">contract_id</span> <span class="o">=</span> <span class="s1">'100400'</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+-------------+---------+------------+------+---------------+-------------+---------+-------+------+----------+-------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">select_type</span> <span class="o">|</span> <span class="k">table</span>   <span class="o">|</span> <span class="n">partitions</span> <span class="o">|</span> <span class="k">type</span> <span class="o">|</span> <span class="n">possible_keys</span> <span class="o">|</span> <span class="k">key</span>         <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>   <span class="o">|</span> <span class="k">rows</span> <span class="o">|</span> <span class="n">filtered</span> <span class="o">|</span> <span class="n">Extra</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+-------------+---------+------------+------+---------------+-------------+---------+-------+------+----------+-------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">SIMPLE</span>      <span class="o">|</span> <span class="n">teacher</span> <span class="o">|</span> <span class="k">NULL</span>       <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="n">contract_id</span>   <span class="o">|</span> <span class="n">contract_id</span> <span class="o">|</span> <span class="mi">22</span>      <span class="o">|</span> <span class="n">const</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>   <span class="mi">100</span><span class="p">.</span><span class="mi">00</span> <span class="o">|</span> <span class="k">NULL</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">----+-------------+---------+------------+------+---------------+-------------+---------+-------+------+----------+-------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span><span class="p">,</span> <span class="mi">1</span> <span class="n">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>
<p>We won’t see similar warning like the above query:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SHOW</span> <span class="n">WARNINGS</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="k">Level</span> <span class="o">|</span> <span class="n">Code</span> <span class="o">|</span> <span class="n">Message</span>                                                                                                                                                                                                                                                                               <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Note</span>  <span class="o">|</span> <span class="mi">1003</span> <span class="o">|</span> <span class="cm">/* select#1 */</span> <span class="k">select</span> <span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`id`</span> <span class="k">AS</span> <span class="nv">`id`</span><span class="p">,</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`name`</span> <span class="k">AS</span> <span class="nv">`name`</span><span class="p">,</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`age`</span> <span class="k">AS</span> <span class="nv">`age`</span><span class="p">,</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`contract_id`</span> <span class="k">AS</span> <span class="nv">`contract_id`</span><span class="p">,</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`join_on`</span> <span class="k">AS</span> <span class="nv">`join_on`</span> <span class="k">from</span> <span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span> <span class="k">where</span> <span class="p">(</span><span class="nv">`test`</span><span class="p">.</span><span class="nv">`teacher`</span><span class="p">.</span><span class="nv">`contract_id`</span> <span class="o">=</span> <span class="s1">'100400'</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="misunderstanding-3-if-key-is-not-null-in-explain-statement-output-it-means-one-of-the-index-is-used-and-the-query-is-efficient">Misunderstanding 3: If <code class="language-plaintext highlighter-rouge">key</code> is not null in <code class="language-plaintext highlighter-rouge">EXPLAIN</code> statement output, it means one of the index is used and the query is efficient</h2>
<p>Yes, if the value of the <code class="language-plaintext highlighter-rouge">key</code> column is not null in <code class="language-plaintext highlighter-rouge">EXPLAIN</code> statement output, it means one of the index is used but it doesn’t mean an index is FULLY used.
To decide if a query is optimized, we need to analyze other columns like <code class="language-plaintext highlighter-rouge">key_len</code>. This column indicates the length of the key the optimizer decided to use with which you can tell how many parts of a composite index are used.
For example, suppose we have a table defined as below and the value for <code class="language-plaintext highlighter-rouge">key_len</code> is 4</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">`col1`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>                   <span class="c1">-- 1 byte</span>
<span class="nv">`col2`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>                   <span class="c1">-- 2 bytes</span>
<span class="nv">`col3`</span> <span class="nb">tinyint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span><span class="p">,</span>        <span class="c1">-- 1 byte</span>
<span class="nv">`col4`</span> <span class="nb">tinyint</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span><span class="p">,</span>        <span class="c1">-- 4 bytes</span>
<span class="k">KEY</span> <span class="nv">`Index`</span> <span class="p">(</span><span class="nv">`col1`</span><span class="p">,</span> <span class="nv">`col2`</span><span class="p">,</span> <span class="nv">`col3`</span><span class="p">,</span> <span class="nv">`col4`</span><span class="p">)</span>
</code></pre></div></div>
<p>Since indexes are used from left to right (leftmost prefix matching principle), only (<code class="language-plaintext highlighter-rouge">col1</code>, <code class="language-plaintext highlighter-rouge">col2</code>, <code class="language-plaintext highlighter-rouge">col3</code>) is used: 1+2+1=4.</p>

<p>In addition, when using <code class="language-plaintext highlighter-rouge">EXPLAIN</code> to analyze your query’s performance, be careful about the sample data you use - it may produce very different query plan result.</p>

<p><em>Reference</em>: Check out the full <code class="language-plaintext highlighter-rouge">EXPLAIN</code> output format via https://dev.mysql.com/doc/refman/8.0/en/explain-output.html.</p>

<h2 id="misunderstanding-4-the-order-of-columns-in-where-clause-matters-in-leftmost-prefix-principle-of-index">Misunderstanding 4: The order of columns in <code class="language-plaintext highlighter-rouge">WHERE</code> clause matters in leftmost prefix principle of index</h2>
<p>The truth is, it doesn’t. Only the order in the index matters.
<strong>TODO</strong></p>

